# This YAML describes the Item structure appropriate for configuring
# the 'simp' scenario. This structure is is used to generate
# an internal YAML object, which represents a decision tree.
# This YAML object is generated by concatenating yaml pieces
# listed in the 'includes' sequence below.
#
---
name: simp
description: |
    Settings for a full SIMP system. Both the SIMP server
    (this host) and all clients will be running with
    all security features enabled.
includes:
- initial_actions
- network_setup
- general_server_setup
- puppet_global_setup
- puppet_env_setup
- yum_setup
- ldap_setup:
  # When we are enabling SIMP LDAP, we are also enabling SSSD and setting
  # the SSSD domain to the SIMP-provided 'LDAP' domain. So, we need to set
  # both simp_options::ldap and simp_options::sssd to true and sssd:domain
  # to 'LDAP'.  The variables below affect those settings by silently using
  # the Item defaults for both simp::options::ldap and simp::options::sssd
  # (both true) and persisting simp_options::ldap to the output YAML files.
  # That persistence of simp_options::ldap is required in order to override
  # the scenario setting for simp_options::ldap.
  - ldap_true_ldap_query_options: 'SKIPQUERY SILENT'
  - ldap_true_ldap_query_comment: 'default enables and overrides scenario setting'
  - ldap_true_sssd_query_options: 'SKIPQUERY SILENT NOYAML'
  - ldap_true_sssd_query_comment: 'default enables and matches scenario setting'

  # When we are disabling SIMP LDAP in this scenario, we want to still keep
  # SSSD enabled and query the user for the sssd::domain.  So, we need to
  # silently set simp_options::ldap to false and simp_options::sssd to true.
  # The variables below affect those settings by overriding the Item default
  # for simp::options::ldap and accepting the Item default for
  # simp::options::sssd.  No persistance to output YAML files is needed,
  # because these settings match those of the scenario.
  - ldap_false_ldap_query_options: 'SKIPQUERY SILENT VALUE=no NOYAML'
  - ldap_false_ldap_query_comment: 'override default to match scenario setting'
  - ldap_false_sssd_query_options: 'SKIPQUERY SILENT NOYAML'
  - ldap_false_sssd_query_comment: 'default enables and matches scenario setting'
- misc_setup
- user_setup
- simp_scenario_specific_setup
